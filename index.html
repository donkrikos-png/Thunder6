<!DOCTYPE html>
<html lang="el">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ThunderCats Tactics 3D</title>

<!-- Three.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.min.js"></script>

<style>
body { margin:0; overflow:hidden; background:#000; font-family: Arial, sans-serif; }
#game-container { position:fixed; top:0; left:0; width:100%; height:100%; }
#loading-screen { position:fixed; top:0; left:0; width:100%; height:100%; background: linear-gradient(45deg,#0f172a,#1e293b); display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:1000; }
.loader { width:80px;height:80px;border:8px solid rgba(245,158,11,0.3);border-top:8px solid #f59e0b;border-radius:50%;animation:spin 1s linear infinite;margin-bottom:20px; }
@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}
#loading-text { color:#f59e0b; font-size:24px; text-align:center; }

#ui-container { position: fixed; bottom:20px; left:50%; transform:translateX(-50%); display:flex; gap:15px; padding:15px; background:rgba(15,23,42,0.8); border-radius:15px; border:2px solid #f59e0b; backdrop-filter: blur(10px); display:none; }
.action-btn { width:60px; height:60px; border-radius:50%; border:none; background:linear-gradient(45deg,#1e40af,#3b82f6); color:white; font-size:24px; cursor:pointer; display:flex; justify-content:center; align-items:center; transition: all 0.3s ease; }
.action-btn:hover { transform: scale(1.1); box-shadow:0 0 20px rgba(59,130,246,0.5);}
.action-btn:disabled { opacity:0.5; cursor:not-allowed; transform:none; }

#character-info { position:fixed; top:20px; left:20px; background:rgba(15,23,42,0.8); padding:15px; border-radius:10px; border:2px solid #f59e0b; color:white; backdrop-filter:blur(10px); display:none; }
.health-bar { width:100%; height:8px; background:#444; border-radius:4px; margin-top:5px; overflow:hidden; }
.health-fill { height:100%; background:linear-gradient(90deg,#ef4444,#22c55e); border-radius:4px; transition: width 0.3s ease; }

#turn-indicator { position:fixed; top:20px; right:20px; background:rgba(15,23,42,0.8); padding:15px; border-radius:10px; border:2px solid #60a5fa; color:white; backdrop-filter:blur(10px); display:none; }

</style>
</head>
<body>

<div id="loading-screen">
  <div class="loader"></div>
  <div id="loading-text">Φόρτωση ThunderCats Tactics...</div>
</div>

<div id="game-container"></div>

<div id="character-info">
  <h3 id="char-name">Lion-O</h3>
  <div>Υγεία: <span id="health-value">100/100</span></div>
  <div class="health-bar"><div class="health-fill" style="width:100%;"></div></div>
  <div>Πόντοι Δράσης: <span id="ap-value">2</span></div>
</div>

<div id="turn-indicator"><h3>Γύρος Παίκτη</h3></div>

<script>
// ------------------------------
// Assets URLs (Public Domain / CC0)
// ------------------------------
const ASSET_URLS = {
  models: {
    lionO: "https://raw.githubusercontent.com/quaternius/assets/main/character.glb",
    tiger: "https://raw.githubusercontent.com/quaternius/assets/main/character2.glb",
    cheetara: "https://raw.githubusercontent.com/quaternius/assets/main/character3.glb",
    mutant: "https://raw.githubusercontent.com/quaternius/assets/main/enemy.glb"
  },
  textures: {
    ground: "https://dl.polyhaven.org/file/ph-assets/Textures/jpg/1k/ground_01.jpg"
  },
  sounds: {
    attack: "https://freesound.org/data/previews/522/522706_915598-lq.mp3",
    move: "https://freesound.org/data/previews/156/156031_2734680-lq.mp3",
    bgm: "https://cdn.pixabay.com/download/audio/2021/12/20/audio_0e84f4e4d5.mp3?filename=ambient-forest-110696.mp3"
  }
};

// ------------------------------
// Three.js Setup
// ------------------------------
let scene, camera, renderer, controls;
let characters=[], selectedCharacter=null, isPlayerTurn=true;
const gridSize=20, cellSize=2;
let grid=[];

function initGame() {
  scene = new THREE.Scene();
  scene.background = new THREE.Color(0x0f172a);

  camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
  camera.position.set(20,25,20);
  camera.lookAt(0,0,0);

  renderer = new THREE.WebGLRenderer({antialias:true});
  renderer.setSize(window.innerWidth, window.innerHeight);
  renderer.shadowMap.enabled = true;
  document.getElementById('game-container').appendChild(renderer.domElement);

  controls = new THREE.OrbitControls(camera, renderer.domElement);
  controls.enableDamping = true;

  // Lights
  const ambient = new THREE.AmbientLight(0x404040, 0.6);
  scene.add(ambient);
  const directional = new THREE.DirectionalLight(0xffffff, 0.8);
  directional.position.set(20,30,20);
  directional.castShadow = true;
  scene.add(directional);

  // Ground
  const groundTex = new THREE.TextureLoader().load(ASSET_URLS.textures.ground);
  const ground = new THREE.Mesh(
    new THREE.PlaneGeometry(100,100),
    new THREE.MeshStandardMaterial({ map: groundTex })
  );
  ground.rotation.x = -Math.PI/2;
  ground.receiveShadow = true;
  scene.add(ground);

  // Grid helper
  const gridHelper = new THREE.GridHelper(gridSize*cellSize, gridSize);
  gridHelper.position.y = 0.1;
  scene.add(gridHelper);
  for(let z=0; z<gridSize; z++){ grid[z]=[]; for(let x=0;x<gridSize;x++){ grid[z][x]=null; } }

  // Load Characters
  loadCharacters().then(()=>{
    document.getElementById('loading-screen').style.display='none';
    document.getElementById('character-info').style.display='block';
    document.getElementById('turn-indicator').style.display='block';
    animate();
  });

  // Window resize
  window.addEventListener('resize', ()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
  });
}

// ------------------------------
// Load Characters (GLTF)
// ------------------------------
async function loadCharacters(){
  const loader = new THREE.GLTFLoader();
  async function loadModel(url,x,z,isPlayer=true){
    return new Promise((resolve)=>{
      loader.load(url,(gltf)=>{
        const mesh=gltf.scene;
        mesh.position.set((x-gridSize/2)*cellSize,0,(z-gridSize/2)*cellSize);
        mesh.scale.set(1.5,1.5,1.5);
        mesh.castShadow=true;
        scene.add(mesh);

        const character = { mesh, gridX:x, gridZ:z, health:100, maxHealth:100, actionPoints:isPlayer?2:1, maxActionPoints:isPlayer?2:1, isPlayer, name:isPlayer?"Player":"Enemy" };
        characters.push(character);
        grid[z][x]=character;
        resolve(character);
      });
    });
  }

  await loadModel(ASSET_URLS.models.lionO,5,5,true);
  await loadModel(ASSET_URLS.models.tiger,7,5,true);
  await loadModel(ASSET_URLS.models.cheetara,5,7,true);

  await loadModel(ASSET_URLS.models.mutant,15,15,false);
  await loadModel(ASSET_URLS.models.mutant,15,13,false);
}
